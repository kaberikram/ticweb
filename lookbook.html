<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Lookbook | TIC Corp.</title>
    <link rel="icon" type="image/png" href="/ticLOGO.png" />
    <link rel="stylesheet" href="/style.css" />
    <!-- Link shared stylesheet -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Source+Code+Pro:ital,wght@0,200..900;1,200..900&display=swap"
      rel="stylesheet"
    />
    <style>
      /* Reset default styles */
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      html,
      body {
        height: 100%;
        width: 100%;
        overflow: hidden; /* Prevent scrollbars */
        font-family: "Source Code Pro", monospace; /* Use consistent font */
        /* Custom cursor: Default (Circle outline + Up arrow) - Larger (40x40), Lighter Outline */
        /* Note: JS will override this on the container based on position */
        cursor: url("data:image/svg+xml;utf8,%3Csvg%20width%3D%2240%22%20height%3D%2240%22%20viewBox%3D%220%200%2024%2024%22%20fill%3D%22none%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%3Ccircle%20cx%3D%2212%22%20cy%3D%2212%22%20r%3D%2210%22%20stroke%3D%22%23aaaaaa%22%20stroke-width%3D%221.5%22%2F%3E%3Cpath%20d%3D%22M12%208%20L10%2012%20L14%2012%20Z%22%20fill%3D%22black%22%2F%3E%3C%2Fsvg%3E")
            20 20,
          auto;
      }

      /* Container for the slideshow */
      #slideshow-container {
        position: relative;
        width: 100%;
        height: 100%;
        background-color: #ffffff; /* Changed to pure white */
        /* In a real scenario, you'd set the background image here */
        /* background-image: url('your-image.jpg'); */
        /* background-size: cover; */
        /* background-position: center; */
      }

      /* Individual slides */
      .slide {
        position: absolute;
        top: 0;
        left: 0; /* Position all slides at the start */
        width: 100%;
        height: 100%;
        opacity: 1; /* Keep slides opaque for transform */
        transition: transform 0.5s ease-in-out; /* Transition the transform property */
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 3rem;
        color: white;
        transform: translateX(100%); /* Start slides off-screen to the right */
      }

      /* Make the first slide visible */
      .slide:first-child {
        /* opacity: 1; NO LONGER NEEDED */
        transform: translateX(0%); /* Bring the first slide into view */
        /* Use z-index if stacking matters more explicitly, */
        /* but opacity handles visibility here */
      }

      /* Placeholder background colors */
      /* #slide1 { background-color: #dc2626; } Red */
      /* #slide2 { background-color: #2563eb; } Blue */
      /* #slide3 { background-color: #16a34a; } Green */
      /* #slide4 { background-color: #ca8a04; } Yellow */

      /* Image backgrounds */
      #slide1 {
        background-image: url("/slideshow1.png");
        background-size: cover;
        background-position: center;
      }
      #slide2 {
        background-image: url("/slideshow2.png");
        background-size: cover;
        background-position: center;
      }
      #slide3 {
        background-image: url("/slideshow3.png");
        background-size: cover;
        background-position: center;
      }

      #slide4 {
        background-image: url("/slideshow4.png");
        background-size: cover;
        background-position: center;
      }
      #slide5 {
        background-image: url("/slideshow5.png");
        background-size: cover;
        background-position: center;
      }
      /* #slide4 removed */

      /* New slide for Perfume */
      #slide6 {
        background-image: url("/slideshow6.png");
        background-size: cover;
        background-position: center;
      }

      /* Style for potential navigation elements (add later if needed) */
      /* .prev, .next { ... } */

      /* Note: Clicking left/right to change slides requires JavaScript. */
      /* This structure sets up the slides; JS would change the 'opacity' */
      /* or use transforms (translateX) to create a sliding effect. */

      /* Logo Styles (copied from style.css) - REMOVED, using linked style.css */
      /* .logo-container { ... } */
      /* .logo { ... } */
      /* End Logo Styles */

      /* Bottom Left Content Styles */
      .slide-content {
        position: absolute;
        bottom: 10vh; /* Increased distance from bottom (was 2rem) */
        left: 2rem; /* Adjust spacing from left */
        color: #111; /* Dark text color */
        z-index: 50; /* Ensure it's above slide background */
        display: flex;
        flex-direction: column; /* Stack title and price/button row */
        align-items: flex-start; /* Align items to the left */
        /* gap: 1.5rem; Removed gap, will use margins */
        font-family: "Source Code Pro", monospace; /* Use consistent font */
      }

      .slide-text-info {
        /* display: flex; No longer needed as wrapper */
        /* flex-direction: column; */
        /* gap: 0.5rem; Removed gap */
        margin-bottom: 1.5rem; /* Space below title (adjust as needed for '30% higher') */
      }

      .slide-title {
        font-size: 1.8rem; /* Adjust size as needed */
        font-weight: bold;
        margin: 0; /* Remove default margins if any */
      }

      /* New row container for price and button */
      .price-button-row {
        display: flex;
        align-items: center; /* Vertically align price and button */
        gap: 1.5rem; /* Space between price and button */
      }

      .slide-price {
        font-size: 1rem; /* Adjust size as needed */
        color: #555; /* Slightly lighter color for price */
        margin: 0; /* Remove default margins */
      }

      .slide-buy-button {
        /* Copied from .nav-button in style.css */
        padding: 8px 15px;
        font-family: "Source Code Pro", monospace; /* Ensure font is consistent */
        font-size: 14px;
        text-decoration: none;
        color: #333;
        background-color: rgba(255, 255, 255, 0.8);
        border: 1px solid #ccc;
        border-radius: 20px;
        transition: background-color 0.2s ease, color 0.2s ease;
        cursor: pointer; /* Keep cursor pointer */
        /* font-weight: normal; Implicit from lack of definition */
        /* font-family: inherit; Use explicit font-family */
      }

      .slide-buy-button:hover {
        /* Copied from .nav-button:hover in style.css */
        background-color: #f0f0f0;
        color: #000;
        /* border-color: #333; Removed as not in source */
      }
      /* End Bottom Left Content Styles */
      
      /* Slide indicators styles - progress bar */
      .slide-indicators {
        position: fixed;
        top: 120px; /* Position below nav bar instead of bottom */
        left: 0;
        right: 0;
        display: none; /* Hide by default for desktop */
        justify-content: center;
        z-index: 100;
      }
      
      /* Base progress bar */
      .progress-bar {
        position: relative;
        width: 150px;
        height: 1px; /* Thinner */
        background-color: rgba(0, 0, 0, 0.15);
        border-radius: 0;
      }
      
      /* Moving indicator */
      .progress-indicator {
        position: absolute;
        width: 15px; /* Narrower */
        height: 2px; /* Thinner */
        background-color: #000;
        border-radius: 0;
        top: -0.5px;
        transition: left 0.3s ease;
      }
      
      /* Only show on mobile */
      @media (max-width: 768px) {
        .slide-indicators {
          display: flex;
        }
      }

      /* Size Guide Popup Styles */
      .size-guide-popup {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.7);
        z-index: 2000;
        justify-content: center;
        align-items: center;
      }

      .size-guide-content {
        background-color: white;
        padding: 30px;
        border-radius: 8px;
        max-width: 90%;
        width: 400px;
        position: relative;
      }

      .size-guide-close {
        position: absolute;
        top: 10px;
        right: 15px;
        font-size: 24px;
        background: none;
        border: none;
        cursor: pointer;
      }

      .size-guide-table {
        width: 100%;
        border-collapse: separate;
        border-spacing: 0;
        margin-top: 15px;
        border-radius: 10px;
        overflow: hidden;
        box-shadow: 0 0 0 1px #ddd;
      }

      .size-guide-table th, 
      .size-guide-table td {
        border-bottom: 1px solid #ddd;
        border-right: 1px solid #ddd;
        padding: 10px 12px;
        text-align: center;
      }

      .size-guide-table th:last-child,
      .size-guide-table td:last-child {
        border-right: none;
      }

      .size-guide-table tr:last-child td {
        border-bottom: none;
      }

      .size-guide-table th {
        font-weight: bold;
        border-bottom: 2px solid #ddd;
      }

      .size-guide-content h3 {
        text-align: center;
        margin-bottom: 15px;
      }

      .virtual-try-on-link {
        display: block;
        text-align: center;
        margin-top: 10px; /* Add some space above */
        margin-bottom: 15px; /* Match h3 margin-bottom for spacing consistency */
        color: #337ab7; /* Standard link color */
        text-decoration: underline;
        font-family: "Source Code Pro", monospace;
        font-size: 14px; /* Match button font size */
      }

      /* Size Toggle Buttons */
      .size-toggle-container {
        display: flex;
        justify-content: center;
        margin-bottom: 15px;
      }
      
      .size-toggle-btn {
        padding: 8px 15px;
        background-color: white;
        border: 1px solid #ccc;
        cursor: pointer;
        font-family: "Source Code Pro", monospace;
        font-size: 14px;
        transition: all 0.2s ease;
      }
      
      .size-toggle-btn:first-child {
        border-radius: 20px 0 0 20px;
      }
      
      .size-toggle-btn:last-child {
        border-radius: 0 20px 20px 0;
      }
      
      .size-toggle-btn.active {
        background-color: #333;
        color: white;
      }
    </style>
  </head>
  <body class="fade-in">
    <!-- Logo Container - Updated to match characterSelection.html -->
    <header class="logo-container">
      <a href="/index.html">
        <!-- Assuming index.html is the target -->
        <img src="/ticLOGO.png" alt="TIC Logo" class="logo" />
      </a>
      <!-- Ratalog Button -->
      <a href="/ratalog.html" class="nav-button">Ratalog</a>
      <!-- Lookbook Button (Active) -->
      <a href="/lookbook.html" class="nav-button active">Lookbook</a>
      <!-- Cart Button -->
      <a href="/cart.html" class="nav-button">Cart</a>
    </header>
    <!-- End Logo Container -->

    <div id="slideshow-container">
      <!-- Removed slide 1 -->
      <div class="slide" id="slide2" data-rat-src="/1Rat.png">
        <div class="slide-content">
          <div class="slide-text-info">
            <p class="slide-title">Ratphex-T</p>
          </div>
          <div class="price-button-row">
            <p class="slide-price">$20</p>
            <button class="slide-buy-button">Buy</button>
          </div>
        </div>
      </div>
      <div class="slide" id="slide3" data-rat-src="/1Rat.png">
        <div class="slide-content">
          <div class="slide-text-info">
            <p class="slide-title">Ratphex-T</p>
          </div>
          <div class="price-button-row">
            <p class="slide-price">$20</p>
            <button class="slide-buy-button">Buy</button>
          </div>
        </div>
      </div>
      <div class="slide" id="slide4" data-rat-src="/3Rat.png">
        <div class="slide-content">
          <div class="slide-text-info">
            <p class="slide-title">AnimalCollective-T</p>
          </div>
          <div class="price-button-row">
            <p class="slide-price">$20</p>
            <button class="slide-buy-button">Buy</button>
          </div>
        </div>
      </div>
      <div class="slide" id="slide5" data-rat-src="/6Rat.png">
        <div class="slide-content">
          <div class="slide-text-info">
            <p class="slide-title">RatwardScissor-T</p>
          </div>
          <div class="price-button-row">
            <p class="slide-price">$30</p>
            <button class="slide-buy-button">Buy</button>
          </div>
        </div>
      </div>
      <!-- New Slide for Perfume -->
      <div class="slide" id="slide6" data-rat-src="/1Perfume.png">
        <div class="slide-content">
          <div class="slide-text-info">
            <p class="slide-title">RATÉE — La Rat <br> Féminine</p>
          </div>
          <div class="price-button-row">
            <p class="slide-price">$299</p>
            <button class="slide-buy-button">Buy</button>
          </div>
        </div>
      </div>

      <!-- Add slide indicators -->
      <div class="slide-indicators">
        <!-- Dots will be added dynamically based on number of slides -->
      </div>

      <!-- Navigation buttons would typically go here -->
      <!-- Example:
        <button class="prev" onclick="changeSlide(-1)">&#10094;</button>
        <button class="next" onclick="changeSlide(1)">&#10095;</button>
        -->
      <!-- JS needed for onclick functionality -->
    </div>

    <!-- JavaScript would go here to handle the slide changes on click -->
    <script>
      let currentSlideIndex = 0;
      const slides = document.querySelectorAll(".slide");
      let totalSlides = slides.length; // Make totalSlides mutable
      const slideIndicators = document.querySelector(".slide-indicators");

      // Create indicator dots based on number of slides
      function createIndicators() {
        if (slideIndicators) {
          // Clear any existing content
          slideIndicators.innerHTML = '';
          
          // Create the progress bar and indicator
          const progressBar = document.createElement("div");
          progressBar.className = "progress-bar";
          
          const progressIndicator = document.createElement("div");
          progressIndicator.className = "progress-indicator";
          progressIndicator.style.left = "0%"; // Start at beginning
          
          progressBar.appendChild(progressIndicator);
          slideIndicators.appendChild(progressBar);
          
          // Add click functionality to progress bar
          progressBar.addEventListener("click", (e) => {
            e.stopPropagation(); // Prevent slideshow container click
            
            // Calculate which portion of the bar was clicked
            const rect = progressBar.getBoundingClientRect();
            const clickPosition = e.clientX - rect.left;
            const percentage = clickPosition / rect.width;
            
            // Determine which slide to show based on click position
            const slideIndex = Math.min(
              totalSlides - 1,
              Math.floor(percentage * totalSlides)
            );
            
            showSlide(slideIndex);
            currentSlideIndex = slideIndex;
          });
        }
      }

      // Update indicator position when slide changes
      function updateIndicators() {
        const progressIndicator = document.querySelector(".progress-indicator");
        if (progressIndicator) {
          // Position is based on current slide index
          // For example: slide 0 of 4 = 0%, slide 1 of 4 = 33%, slide 2 of 4 = 67%, slide 3 of 4 = 100%
          const position = currentSlideIndex / (totalSlides - 1) * 100;
          progressIndicator.style.left = `${position}%`;
        }
      }

      function showSlide(index) {
        slides.forEach((slide, i) => {
          // Calculate the translation based on the current slide index
          // Slide to the left for previous slides, right for next slides
          slide.style.transform = `translateX(${(i - index) * 100}%)`;
        });
        updateIndicators();
      }

      function changeSlide(direction) {
        currentSlideIndex =
          (currentSlideIndex + direction + totalSlides) % totalSlides;
        showSlide(currentSlideIndex);
      }

      // Call createIndicators on page load
      // createIndicators(); // We will call this after updating totalSlides

      // Initial setup - handled by CSS :first-child rule now
      // showSlide(currentSlideIndex);

      // Add event listeners for clicks on the container
      document
        .getElementById("slideshow-container")
        .addEventListener("click", (e) => {
          const containerWidth = window.innerWidth; // Or slideshowContainer.offsetWidth if padding/borders matter

          // Check if the click was on the left or right half of the container
          if (e.clientX < containerWidth / 2) {
            // Clicked left side: Only go previous if NOT on the first slide
            if (currentSlideIndex > 0) {
              changeSlide(-1);
            }
          } else {
            // Clicked right side: Only go next if NOT on the last slide
            if (currentSlideIndex < totalSlides - 1) {
              changeSlide(1);
            }
          }
        });

      // --- Dynamic Cursor Logic ---
      const slideshowContainer = document.getElementById("slideshow-container");
      const defaultCursor =
        "url('data:image/svg+xml;utf8,%3Csvg%20width%3D%2240%22%20height%3D%2240%22%20viewBox%3D%220%200%2024%2024%22%20fill%3D%22none%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%3Ccircle%20cx%3D%2212%22%20cy%3D%2212%22%20r%3D%2210%22%20stroke%3D%22%23aaaaaa%22%20stroke-width%3D%221.5%22%2F%3E%3Cpath%20d%3D%22M12%208%20L10%2012%20L14%2012%20Z%22%20fill%3D%22black%22%2F%3E%3C%2Fsvg%3E') 20 20, auto";
      const leftCursor =
        "url('data:image/svg+xml;utf8,%3Csvg%20width%3D%2240%22%20height%3D%2240%22%20viewBox%3D%220%200%2024%2024%22%20fill%3D%22none%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%3Ccircle%20cx%3D%2212%22%20cy%3D%2212%22%20r%3D%2210%22%20stroke%3D%22%23aaaaaa%22%20stroke-width%3D%221.5%22%2F%3E%3Cpath%20d%3D%22M16%2012%20L10%2010%20L10%2014%20Z%22%20fill%3D%22black%22%2F%3E%3C%2Fsvg%3E') 20 20, auto";
      const rightCursor =
        "url('data:image/svg+xml;utf8,%3Csvg%20width%3D%2240%22%20height%3D%2240%22%20viewBox%3D%220%200%2024%2024%22%20fill%3D%22none%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%3Ccircle%20cx%3D%2212%22%20cy%3D%2212%22%20r%3D%2210%22%20stroke%3D%22%23aaaaaa%22%20stroke-width%3D%221.5%22%2F%3E%3Cpath%20d%3D%22M8%2012%20L14%2010%20L14%2014%20Z%22%20fill%3D%22black%22%2F%3E%3C%2Fsvg%3E') 20 20, auto";

      if (slideshowContainer) {
        slideshowContainer.addEventListener("mousemove", (e) => {
          const rect = slideshowContainer.getBoundingClientRect();
          const containerMidpointX = rect.left + rect.width / 2;

          if (e.clientX < containerMidpointX) {
            // Mouse is on the left, show RIGHT arrow (inverted logic fix)
            slideshowContainer.style.cursor = rightCursor;
          } else {
            // Mouse is on the right, show LEFT arrow (inverted logic fix)
            slideshowContainer.style.cursor = leftCursor;
          }
        });

        slideshowContainer.addEventListener("mouseleave", () => {
          // Reset to the default cursor defined in CSS for html/body
          // Or explicitly set the default if needed
          slideshowContainer.style.cursor = ""; // Let CSS rule apply again
          // Alternatively: slideshowContainer.style.cursor = defaultCursor;
        });
      }
      // --- End Dynamic Cursor Logic ---

      // --- Loading Indicator Logic ---
      document.addEventListener("DOMContentLoaded", () => {
        const loadingIndicator = document.getElementById("loading-indicator");
        const body = document.body;

        if (loadingIndicator) {
          // Make it display: flex first so the opacity transition can happen
          loadingIndicator.style.display = "flex";

          // Then add 'visible' class slightly later to trigger fade-in transition
          setTimeout(() => {
            loadingIndicator.classList.add("visible");
          }, 10); // Minimal delay
        } else {
          console.error("Loading indicator not found!");
        }

        // Wait a bit for loader animation, then fade out loader and fade in content
        setTimeout(() => {
          if (loadingIndicator) {
            loadingIndicator.classList.remove("visible"); // Start fade-out
            // Optionally remove the loader from DOM after fade out
            setTimeout(() => {
              if (loadingIndicator.parentNode) {
                loadingIndicator.parentNode.removeChild(loadingIndicator);
              }
            }, 500); // Match loading indicator transition duration (for fade-out)
          }
          // Remove fade-in class (which hides content) and add content-visible class to fade in content
          body.classList.remove("fade-in");
          body.classList.add("content-visible");
        }, 1000); // Total time loader is visible (including fade-in/out)
      });
      // --- End Loading Indicator Logic ---

      // --- Swipe Support for Mobile Slideshow ---
      let touchStartX = 0;
      let touchEndX = 0;
      const swipeThreshold = 50; // Minimum px to be considered a swipe

      if (slideshowContainer) {
        slideshowContainer.addEventListener("touchstart", function (e) {
          if (e.touches.length === 1) {
            touchStartX = e.touches[0].clientX;
          }
        });

        slideshowContainer.addEventListener("touchmove", function (e) {
          if (e.touches.length === 1) {
            touchEndX = e.touches[0].clientX;
          }
        });

        slideshowContainer.addEventListener("touchend", function (e) {
          const deltaX = touchEndX - touchStartX;
          if (Math.abs(deltaX) > swipeThreshold) {
            if (deltaX < 0 && currentSlideIndex < totalSlides - 1) {
              // Swipe left: next slide
              changeSlide(1);
            } else if (deltaX > 0 && currentSlideIndex > 0) {
              // Swipe right: previous slide
              changeSlide(-1);
            }
          }
          // Reset
          touchStartX = 0;
          touchEndX = 0;
        });
      }
      // --- End Swipe Support ---
    </script>

    <!-- Loading Indicator -->
    <div id="loading-indicator">
      <span id="loading-text" data-text="www.laughwithtic.com"
        >www.laughwithtic.com</span
      >
    </div>
    <!-- End Loading Indicator -->

    <!-- Modal Structure -->
    <div id="modalOverlay" class="modal-overlay">
      <div id="emailModal" class="modal">
        <div class="modal-content initial-state">
          <button id="modalCloseX" class="modal-close-x">&times;</button>
          <img id="modalRatImage" src="/1Rat.png" alt="Selected Rat" class="modal-rat-image">
          <p class="modal-instruction"><span id="modalShirtName">Ratphex-T</span></p>
          <p id="modalShirtPrice" class="modal-price"></p>
          <div class="modal-selection">
            <div class="fitting-type-group">
              <label for="fittingType">Fitting Type:</label>
              <select id="fittingType" class="nav-button">
                <option value="rat">Rat</option>
                <option value="mouse">Mouse</option>
              </select>
            </div>
            <div class="size-group">
              <label for="sizeSelect">Size:</label>
              <select id="sizeSelect" class="nav-button">
                <option value="S">S</option>
                <option value="M">M</option>
                <option value="L">L</option>
                <option value="XL">XL</option>
              </select>
            </div>
          </div>
          <div class="modal-links-row">
            <span class="disclaimer-link" data-tooltip="MADE-TO-ORDER:&#10;Please allow 2-3 weeks for printing and shipping.">Shipping Info</span>
            <button id="sizeGuideButton" class="size-guide-link">Size Guide</button>
          </div>
          <button id="modalCloseButton" class="close-button">Add to Cart</button>
        </div>
      </div>
    </div>
    <!-- End Modal Structure -->

    <!-- Size Guide Popup -->
    <div id="sizeGuidePopup" class="size-guide-popup">
        <div class="size-guide-content">
            <button id="closeSizeGuide" class="size-guide-close">&times;</button>
            <h3>Size Guide</h3>
            <a href="https://lens.snap.com/experience/e1466c58-8e4d-498d-b985-c9412b5fa38e" target="_blank" rel="noopener noreferrer" class="virtual-try-on-link">Virtual Try On</a>
            
            <div class="size-toggle-container">
                <button class="size-toggle-btn active" data-size-type="rat">Rat</button>
                <button class="size-toggle-btn" data-size-type="mouse">Mouse</button>
            </div>
            
            <table class="size-guide-table" id="ratSizeTable">
                <thead>
                    <tr>
                        <th>SIZE</th>
                        <th>CHEST (Half)</th>
                        <th>LENGTH</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>S</td>
                        <td>19"</td>
                        <td>26"</td>
                    </tr>
                    <tr>
                        <td>M</td>
                        <td>20"</td>
                        <td>27"</td>
                    </tr>
                    <tr>
                        <td>L</td>
                        <td>21"</td>
                        <td>28"</td>
                    </tr>
                    <tr>
                        <td>XL</td>
                        <td>22"</td>
                        <td>29"</td>
                    </tr>
                </tbody>
            </table>
            
            <table class="size-guide-table" id="mouseSizeTable" style="display: none;">
                <thead>
                    <tr>
                        <th>SIZE</th>
                        <th>CHEST (Half)</th>
                        <th>LENGTH</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>S</td>
                        <td>17"</td>
                        <td>22"</td>
                    </tr>
                    <tr>
                        <td>M</td>
                        <td>15"</td>
                        <td>20"</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
    <!-- End Size Guide Popup -->

    <script>
      // Modal logic for Lookbook
      document.addEventListener("DOMContentLoaded", function () {
        // Modal elements
        const modalOverlay = document.getElementById("modalOverlay");
        const emailModal = document.getElementById("emailModal");
        const modalRatImage = document.getElementById("modalRatImage");
        const modalShirtName = document.getElementById("modalShirtName");
        const modalShirtPrice = document.getElementById("modalShirtPrice");
        const closeButton = document.getElementById("modalCloseButton");
        const modalCloseX = document.getElementById("modalCloseX");
        const fittingTypeSelect = document.getElementById("fittingType");
        const sizeSelect = document.getElementById("sizeSelect");
        const fittingTypeGroup = document.querySelector('.fitting-type-group');
        const sizeGroup = document.querySelector('.size-group');
        const modalLinksRow = document.querySelector('.modal-links-row');
        const modalContent = document.querySelector('#emailModal .modal-content');
        let perfumeDetailsContainer = null;

        let modalRatBaseSrc = '/1Rat.png'; // Default fallback

        function openModal(itemName, ratSrc, itemPriceString) {
          modalShirtName.textContent = itemName;
          modalRatBaseSrc = ratSrc; 
          modalRatImage.src = ratSrc; 
          if (modalShirtPrice) modalShirtPrice.textContent = itemPriceString;

          // Remove perfume details container if it exists from a previous open
          if (perfumeDetailsContainer && perfumeDetailsContainer.parentNode) {
            perfumeDetailsContainer.parentNode.removeChild(perfumeDetailsContainer);
            perfumeDetailsContainer = null;
          }

          // Default visibility for clothing items
          if(fittingTypeGroup) fittingTypeGroup.style.display = 'flex';
          if(sizeGroup) sizeGroup.style.display = 'flex';
          if(modalLinksRow) modalLinksRow.style.display = 'flex';

          if (itemName.toLowerCase().includes('ratée')) {
            // Perfume specific setup
            if(fittingTypeGroup) fittingTypeGroup.style.display = 'none';
            if(sizeGroup) sizeGroup.style.display = 'none';
            if(modalLinksRow) modalLinksRow.style.display = 'none'; // Hide the row with size guide/shipping

            perfumeDetailsContainer = document.createElement('div');
            perfumeDetailsContainer.className = 'perfume-details-container';
            perfumeDetailsContainer.style.textAlign = 'left';
            perfumeDetailsContainer.style.fontSize = '0.85em';
            perfumeDetailsContainer.style.lineHeight = '1.6';
            perfumeDetailsContainer.style.width = '100%';
            perfumeDetailsContainer.style.color = '#333';

            perfumeDetailsContainer.innerHTML = `
              <p><strong>Size:</strong><br>150 ml (5.1 fl oz)</p>
              <p><strong>Fragrance Family:</strong> Floral Musk</p>
              <p><strong>Intensity:</strong> Eau de Parfum</p>
              <p><strong>Fragrance Notes</strong></p>
              <ul style="list-style-position: inside; padding-left: 0; margin-top: -5px;">
                <li><strong>Top:</strong> Lychee, Pink Pepper, Bergamot</li>
                <li><strong>Heart:</strong> Iris, Jasmine Tea, Rose Petal</li>
                <li><strong>Base:</strong> White Musk, Cashmere Wood, Vanilla Veil</li>
              </ul>
            `;
            // Insert perfume details before the Add to Cart button
            if (modalContent && closeButton) {
              modalContent.insertBefore(perfumeDetailsContainer, closeButton);
            }

          } else {
            // For non-perfume items, set default fitting type and trigger image update if necessary
            if (fittingTypeSelect) {
              fittingTypeSelect.value = "mouse"; // Default to mouse for clothes
              fittingTypeSelect.dispatchEvent(new Event("change"));
            }
          }
          modalOverlay.style.display = "flex";
          document.body.style.overflow = "hidden";
        }

        function closeModal() {
          modalOverlay.style.display = "none";
          document.body.style.overflow = "";
        }
        if (modalCloseX) modalCloseX.addEventListener("click", closeModal);
        modalOverlay.addEventListener("click", function (event) {
          if (event.target === modalOverlay) closeModal();
        });
        // Setup fitting/size logic
        function setupFittingTypeSizeDropdowns() {
          if (!fittingTypeSelect || !sizeSelect || !modalRatImage) return;
          fittingTypeSelect.value = "mouse";
          function updateSizeOptions() {
            sizeSelect.innerHTML = "";
            if (fittingTypeSelect.value === "rat") {
              ["S", "M", "L", "XL"].forEach((size) => {
                const opt = document.createElement("option");
                opt.value = size;
                opt.textContent = size;
                sizeSelect.appendChild(opt);
              });
            } else {
              ["S", "M"].forEach((size) => {
                const opt = document.createElement("option");
                opt.value = size;
                opt.textContent = size;
                sizeSelect.appendChild(opt);
              });
            }
          }
          function updateModalRatImage() {
            // Use modalRatBaseSrc as the base image
            if (fittingTypeSelect.value === "rat") {
              if (modalRatBaseSrc.endsWith('.png')) {
                let ratSrc = modalRatBaseSrc.replace(/Rat(\.png)$/,'RatM$1');
                if (modalRatBaseSrc.includes('RatM')) ratSrc = modalRatBaseSrc;
                modalRatImage.src = ratSrc;
              } else {
                modalRatImage.src = modalRatBaseSrc;
              }
            } else {
              if (modalRatBaseSrc.includes('RatM')) {
                let mouseSrcFixed = modalRatBaseSrc.replace('RatM', 'Rat');
                modalRatImage.src = mouseSrcFixed;
              } else {
                modalRatImage.src = modalRatBaseSrc;
              }
            }
          }
          fittingTypeSelect.addEventListener("change", function () {
            updateSizeOptions();
            updateModalRatImage();
          });
          updateSizeOptions();
          updateModalRatImage();
        }
        setupFittingTypeSizeDropdowns();

        // Size Guide functionality
        const sizeGuideButton = document.getElementById('sizeGuideButton');
        const sizeGuidePopup = document.getElementById('sizeGuidePopup');
        const closeSizeGuide = document.getElementById('closeSizeGuide');
        const ratSizeTable = document.getElementById('ratSizeTable');
        const mouseSizeTable = document.getElementById('mouseSizeTable');
        const sizeToggleBtns = document.querySelectorAll('.size-toggle-btn');

        if (sizeGuideButton && sizeGuidePopup && closeSizeGuide) {
            // Show size guide when button is clicked
            sizeGuideButton.addEventListener('click', function(e) {
                e.preventDefault();
                e.stopPropagation();
                
                // Set the current size table based on the selected fitting type
                if (fittingTypeSelect) {
                    const currentFittingType = fittingTypeSelect.value;
                    
                    // Show the appropriate table based on current fitting type
                    if (currentFittingType === 'rat') {
                        ratSizeTable.style.display = 'table';
                        mouseSizeTable.style.display = 'none';
                        // Update toggle buttons
                        sizeToggleBtns.forEach(btn => {
                            if (btn.getAttribute('data-size-type') === 'rat') {
                                btn.classList.add('active');
                            } else {
                                btn.classList.remove('active');
                            }
                        });
                    } else {
                        ratSizeTable.style.display = 'none';
                        mouseSizeTable.style.display = 'table';
                        // Update toggle buttons
                        sizeToggleBtns.forEach(btn => {
                            if (btn.getAttribute('data-size-type') === 'mouse') {
                                btn.classList.add('active');
                            } else {
                                btn.classList.remove('active');
                            }
                        });
                    }
                }
                
                sizeGuidePopup.style.display = 'flex';
            });

            // Close size guide when X is clicked
            closeSizeGuide.addEventListener('click', function() {
                sizeGuidePopup.style.display = 'none';
            });

            // Close size guide when clicking outside the content
            sizeGuidePopup.addEventListener('click', function(e) {
                if (e.target === sizeGuidePopup) {
                    sizeGuidePopup.style.display = 'none';
                }
            });
            
            // Handle size type toggle
            if (sizeToggleBtns.length) {
                sizeToggleBtns.forEach(btn => {
                    btn.addEventListener('click', function() {
                        // Remove active class from all buttons
                        sizeToggleBtns.forEach(b => b.classList.remove('active'));
                        
                        // Add active class to clicked button
                        this.classList.add('active');
                        
                        // Show the appropriate table
                        const sizeType = this.getAttribute('data-size-type');
                        if (sizeType === 'rat') {
                            ratSizeTable.style.display = 'table';
                            mouseSizeTable.style.display = 'none';
                        } else {
                            ratSizeTable.style.display = 'none';
                            mouseSizeTable.style.display = 'table';
                        }
                    });
                });
            }
        }

        // Attach to all buy buttons
        document.querySelectorAll(".slide-buy-button").forEach((btn) => {
          // For desktop clicks
          btn.addEventListener("click", function (event) {
            event.stopPropagation();
            const slide = btn.closest('.slide');
            const itemName = slide.querySelector('.slide-title').textContent;
            const itemPriceString = slide.querySelector('.slide-price').textContent;
            const ratSrc = slide.getAttribute('data-rat-src') || '/placeholderRat.png';
            openModal(itemName, ratSrc, itemPriceString);
          });
          
          // For mobile touches - prevent propagation at touchstart
          btn.addEventListener("touchstart", function(event) {
            event.stopPropagation();
          });
          
          btn.addEventListener("touchend", function(event) {
            event.stopPropagation();
            event.preventDefault(); 
            
            const slide = btn.closest('.slide');
            const itemName = slide.querySelector('.slide-title').textContent;
            const itemPriceString = slide.querySelector('.slide-price').textContent;
            const ratSrc = slide.getAttribute('data-rat-src') || '/placeholderRat.png';
            openModal(itemName, ratSrc, itemPriceString);
          });
        });

        // Handle Add to Cart button click
        const addToCartButton = document.getElementById("modalCloseButton");
        if (addToCartButton) {
          addToCartButton.addEventListener("click", () => {
            addToCartButton.disabled = true;
            const itemName = modalShirtName.textContent;
            let fitType = 'N/A'; // Default for perfume
            let size = 'Standard'; // Default for perfume
            let priceCents;
            let imageSrcForCart = modalRatImage.src; // Get the currently displayed image in the modal

            if (itemName.toLowerCase().includes('ratée')) {
              priceCents = 29900;
              // For the perfume, fit and size are not selected via dropdown.
              // imageSrcForCart is already set from modalRatImage.src which is /1Perfume.png
            } else {
              // Existing logic for T-shirts
              fitType = fittingTypeSelect.value;
              size = sizeSelect.value;
              priceCents = itemName.includes("Ratward") ? 3000 : 2000;
              // For T-shirts, the image in cart is determined by cart.html's logic,
              // but we can pass the specific one if needed:
              // if (itemName.includes('Ratphex')) imageSrcForCart = '/1Shirt.png';
              // else if (itemName.includes('AnimalCollective')) imageSrcForCart = '/3Shirt.png';
              // else if (itemName.includes('Ratward')) imageSrcForCart = '/6Shirt.png';
              // else imageSrcForCart = '/placeholder.png';
              // For now, we won't pass imageSrcForCart for T-shirts to let cart.html handle it.
              imageSrcForCart = undefined; // Let cart.html decide for T-shirts
            }

            const cartItem = {
              name: itemName,
              fit: fitType,
              size: size,
              price: priceCents,
              quantity: 1,
              imageSrc: imageSrcForCart // Pass the specific image source for the perfume
            };

            const existing = JSON.parse(localStorage.getItem("cart") || "[]");
            existing.push(cartItem);
            localStorage.setItem("cart", JSON.stringify(existing));
            addToCartButton.textContent = "Added!";
            setTimeout(() => {
              addToCartButton.textContent = "Add to Cart";
              addToCartButton.disabled = false;
            }, 1200);
          });
        } else {
          console.error("Add to Cart button not found");
        }

        // Update slide-related JS after DOM is fully parsed and new slide is counted
        const allSlidesNow = document.querySelectorAll(".slide");
        totalSlides = allSlidesNow.length; // Update totalSlides
        if (slides.length !== totalSlides) { // If slides const is stale
            // slides = allSlidesNow; // This might cause issues if slides const is used elsewhere with old NodeList
            console.warn("Slide list updated. Re-initializing indicators if necessary.");
        }
        createIndicators(); // Now call createIndicators with the correct totalSlides
        showSlide(currentSlideIndex); // Ensure the first slide is shown correctly

      });
    </script>
  </body>
</html>
